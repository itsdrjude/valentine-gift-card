<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Valentine Card Gift ğŸ’</title>

  <!-- Romantic modern fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700;800&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#fff0f6; --bg2:#f3f0ff; --text:#2b2b2b; --muted:#6a6a7a;
      --accent:#ff4d8d; --accent2:#7c5cff;
      --shadow: 0 20px 50px rgba(0,0,0,.14); --radius:24px;
      --cardbg: rgba(255,255,255,.86);
      --border: rgba(255,255,255,.95);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      min-height:100vh;
      overflow-x:hidden;
      background:
        radial-gradient(1200px 800px at 20% 10%, var(--bg1), transparent 60%),
        radial-gradient(1200px 800px at 80% 90%, var(--bg2), transparent 55%),
        linear-gradient(135deg, #ffffff, #fff7fb);
      -webkit-tap-highlight-color: transparent;
    }

    /* Loading screen */
    .loader{
      position:fixed; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:9999;
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(255,240,246,.95), transparent 60%),
        radial-gradient(1200px 800px at 80% 90%, rgba(243,240,255,.95), transparent 55%),
        linear-gradient(135deg, #ffffff, #fff7fb);
    }
    .loaderCard{
      max-width:720px;
      width:92%;
      border-radius:28px;
      padding:clamp(18px, 4vw, 28px);
      text-align:center;
      background: rgba(255,255,255,.75);
      border:1px solid rgba(255,255,255,.95);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow: 0 26px 90px rgba(0,0,0,.30);
    }
    .loaderTitle{
      font-family:"Playfair Display", serif;
      font-weight:800;
      font-size:clamp(26px, 4vw, 42px);
      margin-bottom:12px;
    }
    .typeText{
      font-weight:600;
      color:#5a5a7a;
      font-size:clamp(14px, 2.2vw, 18px);
      line-height:1.6;
      min-height:3.5em;
    }
    .cursor{
      display:inline-block;
      width:2px;
      height:1em;
      background:#ff4d8d;
      margin-left:2px;
      animation: blink 1s steps(1) infinite;
      vertical-align:middle;
    }
    @keyframes blink{ 50%{opacity:0} }
    .loader.hide{ animation: fadeOut 600ms ease forwards; }
    @keyframes fadeOut{ to{ opacity:0; visibility:hidden; } }

    .wrap{max-width:1100px;margin:0 auto;padding:24px 16px 90px;position:relative;z-index:2}
    .topbar{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:18px}
    .badge{
      padding:12px 16px;border-radius:999px;background:var(--cardbg);
      border:1px solid var(--border);font-weight:800;
      box-shadow: 0 12px 28px rgba(0,0,0,.08);
    }
    .mini{font-size:12px;color:var(--muted);font-weight:700;text-align:right;line-height:1.2;padding-top:6px}

    .hero{
      border-radius:var(--radius);
      background:var(--cardbg);
      border:1px solid var(--border);
      box-shadow:var(--shadow);
      padding:clamp(18px, 3vw, 28px);
      overflow:hidden;
      position:relative;
    }
    .hero:before{
      content:"";position:absolute;inset:-2px;
      background:
        radial-gradient(700px 280px at 10% 10%, rgba(255,77,141,.18), transparent 60%),
        radial-gradient(700px 280px at 90% 90%, rgba(124,92,255,.16), transparent 60%);
      pointer-events:none;
    }
    .hero > *{position:relative;z-index:1}

    h1{
      margin:0 0 10px 0;
      font-family:"Playfair Display", serif;
      font-weight:800;
      font-size:clamp(30px, 4.5vw, 54px);
      letter-spacing:-.02em;
      line-height:1.05;
    }
    .subtitle{
      margin:0;color:var(--muted);font-weight:500;line-height:1.6;
      max-width:72ch;font-size:clamp(15px, 1.8vw, 18px);
    }

    .name-row{display:flex;flex-wrap:wrap;gap:12px;margin-top:16px;align-items:stretch}
    .input{
      display:flex;gap:10px;align-items:center;
      padding:12px 14px;border-radius:16px;background:#fff;border:1px solid #eee;
      flex:1 1 260px;min-width:220px
    }
    .input input{border:none;outline:none;width:100%;font-weight:700;font-size:16px;background:transparent;color:var(--text)}

    .btn{
      border:none;cursor:pointer;padding:12px 16px;border-radius:16px;
      font-weight:800;color:#fff;
      background:linear-gradient(135deg,var(--accent),#ff7ab5);
      box-shadow: 0 14px 28px rgba(255,77,141,.25);
      font-size:15px;min-height:44px;
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      transition: transform .12s ease, box-shadow .12s ease;
      user-select:none;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.secondary{
      background:linear-gradient(135deg,var(--accent2),#9a7dff);
      box-shadow: 0 14px 28px rgba(124,92,255,.22);
    }
    .btn.ghost{
      background:rgba(255,255,255,.85);
      border:1px solid rgba(255,255,255,.95);
      color:var(--text);
      box-shadow:none;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:18px;margin-top:18px}
    .card{
      border-radius:var(--radius);background:var(--cardbg);
      border:1px solid var(--border);box-shadow:var(--shadow);
      padding:clamp(16px, 2.5vw, 22px);overflow:hidden;
    }
    .card h3{
      margin:0 0 10px 0;
      font-family:"Playfair Display", serif;
      font-weight:700;
      font-size:clamp(20px, 2.4vw, 26px);
    }

    .reasons{display:grid;gap:10px;margin-top:10px}
    .reason{background:#fff;border:1px solid #eee;border-radius:16px;padding:12px 14px;font-weight:600;line-height:1.45;font-size:14px}

    /* Mini memories */
    .memories{display:grid;gap:12px;margin-top:12px}
    .memory-item{background:#fff;border:1px solid #eee;border-radius:18px;padding:14px 16px}
    .memory-title{font-weight:800;display:flex;justify-content:space-between;gap:10px;font-size:15px}
    .memory-label{color:var(--muted);font-weight:700;font-size:12px;white-space:nowrap;padding-top:2px}
    .memory-text{margin:8px 0 0 0;color:var(--muted);font-weight:500;line-height:1.6;font-size:14px}

    /* Fade-in on scroll */
    .reveal{opacity:0;transform: translateY(14px);transition: opacity 800ms ease, transform 800ms ease}
    .reveal.show{opacity:1;transform: translateY(0)}

    /* Floating hearts */
    .hearts{position:fixed;inset:0;pointer-events:none;z-index:0}
    .heart{position:absolute;bottom:-20px;opacity:.85;animation:floatUp linear forwards;filter: drop-shadow(0 10px 14px rgba(0,0,0,.12))}
    @keyframes floatUp{from{transform:translateY(0);opacity:0}10%{opacity:.85}to{transform:translateY(-120vh);opacity:0}}

    /* Confetti burst */
    .burst{position:fixed;inset:0;pointer-events:none;z-index:3}
    .confetti{position:absolute;width:8px;height:14px;border-radius:3px;opacity:.95;animation:pop 900ms ease-out forwards;box-shadow:0 10px 18px rgba(0,0,0,.10)}
    @keyframes pop{from{transform:translate(0,0) rotate(0deg) scale(1);opacity:1}to{transform:translate(var(--x),var(--y)) rotate(var(--r)) scale(.9);opacity:0}}

    /* Toast */
    .toast{
      position:fixed;left:50%;bottom:24px;transform:translateX(-50%) translateY(20px);
      min-width:240px;max-width:min(92vw,520px);
      padding:14px 18px;border-radius:999px;text-align:center;
      font-weight:800;font-size:15px;color:#2b2b2b;
      background:rgba(255,255,255,.75);border:1px solid rgba(255,255,255,.9);
      backdrop-filter: blur(16px);-webkit-backdrop-filter: blur(16px);
      box-shadow:0 20px 50px rgba(0,0,0,.22);
      opacity:0;pointer-events:none;transition:opacity 350ms ease, transform 350ms ease;z-index:999;
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

    /* Liquid glass modal (name/link + letter) */
    .modal{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      padding:16px;z-index:20;
      background: rgba(20, 18, 30, .35);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .modal.show{display:flex}
    .modal::before,.modal::after{
      content:"";position:absolute;width:520px;height:520px;border-radius:999px;
      filter: blur(50px);opacity:.85;pointer-events:none;
    }
    .modal::before{
      left:-160px;top:-160px;
      background: radial-gradient(circle at 30% 30%, rgba(255, 92, 166, .75), rgba(255, 92, 166, .15) 55%, rgba(255, 92, 166, 0) 72%);
    }
    .modal::after{
      right:-180px;bottom:-180px;
      background: radial-gradient(circle at 60% 60%, rgba(124, 92, 255, .70), rgba(124, 92, 255, .18) 55%, rgba(124, 92, 255, 0) 72%);
    }

    .modal-card{
      position:relative;
      width:min(780px, 100%);
      max-width: 860px;
      border-radius: 28px;
      padding: clamp(16px, 3vw, 22px);
      box-shadow: 0 26px 90px rgba(0,0,0,.30);
      overflow:hidden;
      background: rgba(255,255,255,.70);
      border: 1px solid rgba(255,255,255,.70);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }
    .modal-card::before{
      content:"";position:absolute;inset:-2px;
      background:
        radial-gradient(520px 220px at 16% 18%, rgba(255,92,166,.35), transparent 60%),
        radial-gradient(520px 220px at 88% 86%, rgba(124,92,255,.30), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.55));
      pointer-events:none;
    }
    .modal-card > *{position:relative;z-index:1}

    .modal-card h3{
      margin:0 0 8px 0;
      font-family:"Playfair Display", serif;
      font-size:clamp(22px, 3vw, 32px);
      letter-spacing:-.02em;
    }
    .modal-card p{margin:0 0 14px 0;color:var(--muted);font-weight:600;line-height:1.6;font-size:clamp(14px, 2vw, 18px)}

    .sharebox{display:none;gap:10px;margin-top:12px}
    .link{
      background: rgba(255,255,255,.8);
      padding:12px 14px;border-radius:14px;
      font-size:12px;word-break:break-all;border:1px solid rgba(255,255,255,.95);
      font-weight:700;color:#2b2b2b;
    }
    .modal-actions{margin-top:14px;display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}

    /* Letter content area inside modal */
    .letterBox{
      background: rgba(255,255,255,.82);
      border: 1px solid rgba(255,255,255,.9);
      border-radius: 18px;
      padding: 14px 16px;
      max-height: 52vh;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      box-shadow: 0 14px 40px rgba(0,0,0,.06);
      margin-top: 8px;
      line-height:1.75;
      font-size: 15px;
    }
    .letterBox .sig{font-weight:800}
    .letterFooter{
      position: sticky;
      bottom: 0;
      margin-top: 12px;
      padding-top: 12px;
      display:flex;
      gap:10px;
      justify-content:flex-end;
      flex-wrap:wrap;
      background: linear-gradient(180deg, rgba(255,255,255,0), rgba(255,255,255,.78) 40%, rgba(255,255,255,.88));
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    /* Gifts overlay (rain) */
    .giftsOverlay{
      position:fixed; inset:0;
      display:none;
      z-index:30;
      overflow:hidden;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(255,240,246,.9), transparent 55%),
                  radial-gradient(1200px 800px at 80% 90%, rgba(243,240,255,.9), transparent 55%),
                  rgba(255,255,255,.65);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .giftsOverlay.show{display:block}
    .giftsTop{
      position:absolute; left:0; right:0; top:0;
      padding:14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      z-index:2;
    }
    .giftsTitle{
      font-family:"Playfair Display", serif;
      font-weight:800;
      font-size:clamp(18px, 2.4vw, 26px);
      background: rgba(255,255,255,.72);
      border:1px solid rgba(255,255,255,.9);
      border-radius:999px;
      padding:10px 14px;
      box-shadow: 0 18px 45px rgba(0,0,0,.12);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }
    .giftRain{position:absolute; inset:0; pointer-events:none; z-index:1;}
    .giftItem{
      position:absolute;
      top:-40px;
      animation: rain linear forwards;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.14));
      will-change: transform, opacity;
      user-select:none;
    }
    @keyframes rain{
      from{ transform: translateY(-50px) rotate(0deg); opacity:0; }
      10%{ opacity: 1; }
      to{ transform: translateY(115vh) rotate(360deg); opacity: 0; }
    }

    /* Add Memory Sheet */
    .sheet{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.38);z-index:25;padding:14px;backdrop-filter: blur(10px);-webkit-backdrop-filter: blur(10px)}
    .sheet.show{display:flex}
    .sheet-card{
      width:min(860px,100%);
      background: rgba(255,255,255,.90);
      border-radius:24px;
      padding:16px;
      box-shadow: 0 24px 70px rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.95);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }
    .sheet-top{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:12px}
    .sheet-top h3{margin:0;font-family:"Playfair Display", serif;font-size:20px}
    .sheet-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .field{display:grid;gap:6px}
    .field label{font-size:12px;font-weight:800;color:var(--muted)}
    .field input,.field textarea{
      border:1px solid rgba(0,0,0,.08);
      border-radius:14px;
      padding:10px 12px;
      font-weight:600;font-size:14px;outline:none;width:100%;
      font-family: inherit;
      background: rgba(255,255,255,.9);
    }
    .field textarea{min-height:90px;resize:vertical}
    .sheet-actions{margin-top:12px;display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}

    /* Responsive */
    @media (max-width: 900px){ .grid{grid-template-columns:1fr} }
    @media (max-width: 600px){
      .wrap{padding:16px 12px 90px}
      .btn{width:100%}
      .modal-actions .btn{width:100%}
      .letterFooter .btn{width:100%}
      .sheet-grid{grid-template-columns:1fr}
      .sheet-actions .btn{width:100%}
      .giftsTop{flex-direction:column;align-items:stretch}
    }
  </style>
</head>

<body>
  <!-- Loader -->
  <div class="loader" id="loader">
    <div class="loaderCard">
      <div class="loaderTitle">ğŸ’ Valentine Card Gift</div>
      <div class="typeText">
        <span id="typedText"></span><span class="cursor"></span>
      </div>
    </div>
  </div>

  <div class="hearts" id="hearts"></div>
  <div class="burst" id="burst"></div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Name + link modal -->
  <div class="modal" id="startModal" aria-hidden="true">
    <div class="modal-card">
      <h3>Make it personal ğŸ’—</h3>
      <p>Enter your friendâ€™s name once â€” weâ€™ll create a link you can share. When they open it, their name is already there âœ…</p>

      <div class="input">
        <input id="modalFriendName" placeholder="e.g., Monica, Steffi, Johnâ€¦" maxlength="28" inputmode="text" />
      </div>

      <div class="sharebox" id="shareBox">
        <div class="link" id="shareLinkText"></div>
        <button class="btn secondary" id="copyBtn" type="button">Copy Link ğŸ“‹</button>
        <a class="btn" id="openLink" target="_blank" rel="noopener noreferrer">Open Link ğŸ”—</a>
      </div>

      <div class="modal-actions">
        <button class="btn" id="createLinkBtn" type="button">Create Link âœ¨</button>
        <button class="btn ghost" id="skipBtn" type="button">Skip for now</button>
      </div>

      <p style="margin-top:12px;font-size:13px;color:var(--muted);font-weight:600;">
        Note: personalized link uses URL (example: ?to=Name). Anyone with the link can see that name.
      </p>
    </div>
  </div>

  <!-- Letter modal -->
  <div class="modal" id="letterModal" aria-hidden="true">
    <div class="modal-card">
      <h3>ğŸ’Œ A little letter for <span id="letterName">Bestie</span></h3>
      <p>Scroll and read â€” this one is made with friendship + good vibes âœ¨</p>

      <div class="letterBox" id="letterBox">
        <p><b>Dear <span id="letterInlineName">Bestie</span>,</b></p>
        <p>
          I just wanted to tell you something simple but real:
          youâ€™re one of my favorite people.
        </p>
        <p>
          You make life lighter, funnier, and honestly better.
          Thank you for being the kind of friend who shows up,
          listens, laughs, and stays.
        </p>
        <p>
          Hereâ€™s to more memories, more inside jokes, and more â€œweâ€™ll talk laterâ€ chats that turn into hours ğŸ˜„
        </p>
        <p class="sig"><b>Happy Valentineâ€™s Day ğŸ’—</b><br/>â€” Your Friend</p>
      </div>

      <div class="letterFooter">
        <button class="btn secondary" id="openGiftsBtn" type="button">Open Gifts ğŸ</button>
        <button class="btn ghost" id="closeLetterBtn" type="button">Close Letter âœ–</button>
      </div>
    </div>
  </div>

  <!-- Gifts overlay -->
  <div class="giftsOverlay" id="giftsOverlay" aria-hidden="true">
    <div class="giftsTop">
      <div class="giftsTitle" id="giftsTitle">ğŸ Gifts Rain for Bestie!</div>
      <button class="btn ghost" id="closeGiftsBtn" type="button">Close Gifts âœ–</button>
    </div>
    <div class="giftRain" id="giftRain"></div>
  </div>

  <!-- Add Memory Sheet -->
  <div class="sheet" id="memorySheet" aria-hidden="true">
    <div class="sheet-card">
      <div class="sheet-top">
        <h3>Add a memory âœï¸</h3>
        <button class="btn ghost" id="closeSheetBtn" type="button">Close</button>
      </div>

      <div class="sheet-grid">
        <div class="field">
          <label for="memTitle">Title (with emoji)</label>
          <input id="memTitle" placeholder="e.g., ğŸ‰ That surprise moment" maxlength="60" />
        </div>

        <div class="field">
          <label for="memLabel">Label (small tag)</label>
          <input id="memLabel" placeholder="e.g., Best day" maxlength="24" />
        </div>

        <div class="field" style="grid-column: 1 / -1;">
          <label for="memText">Memory text</label>
          <textarea id="memText" placeholder="Write the memory here..." maxlength="220"></textarea>
        </div>
      </div>

      <div class="sheet-actions">
        <button class="btn secondary" id="saveMemoryBtn" type="button">Save Memory âœ…</button>
        <button class="btn ghost" id="clearMemoryBtn" type="button">Clear</button>
      </div>
    </div>
  </div>

  <main class="wrap">
    <div class="topbar">
      <div class="badge">Friendship Valentine ğŸ’</div>
      <div class="mini">Saturday, February 14th, 2026</div>
    </div>

    <section class="hero reveal">
      <h1 id="headline">Happy Valentineâ€™s Day, Bestie! ğŸ’—</h1>
      <p class="subtitle">Just a friendly reminder that youâ€™re appreciated and awesome.</p>

      <div class="name-row">
        <div class="input">
          <input id="friendName" value="My Favorite Human" maxlength="28" />
        </div>
        <button class="btn" id="openLetterMainBtn" type="button">Open Letter ğŸ’Œ</button>
        <button class="btn secondary" id="burstBtn" type="button">Friendship Burst ğŸ‰</button>
      </div>
    </section>

    <section class="grid">
      <div class="card reveal">
        <h3>Why youâ€™re awesome âœ¨</h3>
        <div class="reasons">
          <div class="reason reveal">ğŸ¤ You always show up when it matters.</div>
          <div class="reason reveal">ğŸ˜‚ You make even boring days fun.</div>
          <div class="reason reveal">ğŸŒˆ You bring good vibes everywhere.</div>
          <div class="reason reveal">ğŸ«¶ Youâ€™re a safe place to talk.</div>
        </div>
      </div>

      <div class="card reveal">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
          <h3>Mini memories ğŸ“’</h3>
          <button class="btn ghost" id="addMemoryBtn" type="button">+ Add a memory</button>
        </div>

        <div class="memories" id="memoriesList">
          <div class="memory-item reveal">
            <div class="memory-title">
              <span>ğŸ¬ That one time we couldnâ€™t stop laughing</span>
              <span class="memory-label">Core memory</span>
            </div>
            <p class="memory-text">We laughed so hard it hurt. I still smile thinking about it.</p>
          </div>

          <div class="memory-item reveal">
            <div class="memory-title">
              <span>ğŸŸ Our comfort-food tradition</span>
              <span class="memory-label">Always hits</span>
            </div>
            <p class="memory-text">Food + you = instant happiness. Thatâ€™s science.</p>
          </div>

          <div class="memory-item reveal">
            <div class="memory-title">
              <span>ğŸ«¶ When you helped me</span>
              <span class="memory-label">Grateful</span>
            </div>
            <p class="memory-text">You showed up when it mattered â€” Iâ€™ll never forget that.</p>
          </div>
        </div>

        <p style="margin:12px 0 0 0;color:var(--muted);font-weight:500;line-height:1.6;" class="reveal">
          Tip: your added memories are saved on this device (browser).
          Help : want to create your own valentine card use : https://rebrand.ly/valentine-card
        </p>
      </div>
    </section>
  </main>

  <script>
    // ===== Elements
    const loader = document.getElementById("loader");
    const typedEl = document.getElementById("typedText");

    const startModal = document.getElementById("startModal");
    const modalFriendName = document.getElementById("modalFriendName");
    const createLinkBtn = document.getElementById("createLinkBtn");
    const skipBtn = document.getElementById("skipBtn");
    const shareBox = document.getElementById("shareBox");
    const shareLinkText = document.getElementById("shareLinkText");
    const copyBtn = document.getElementById("copyBtn");
    const openLink = document.getElementById("openLink");

    const friendName = document.getElementById("friendName");
    const headline = document.getElementById("headline");

    const toastEl = document.getElementById("toast");
    let toastTimer = null;

    const burstBtn = document.getElementById("burstBtn");

    // Letter modal
    const openLetterMainBtn = document.getElementById("openLetterMainBtn");
    const letterModal = document.getElementById("letterModal");
    const closeLetterBtn = document.getElementById("closeLetterBtn");
    const openGiftsBtn = document.getElementById("openGiftsBtn");
    const letterName = document.getElementById("letterName");
    const letterInlineName = document.getElementById("letterInlineName");
    const letterBox = document.getElementById("letterBox");

    // Gifts overlay
    const giftsOverlay = document.getElementById("giftsOverlay");
    const closeGiftsBtn = document.getElementById("closeGiftsBtn");
    const giftRain = document.getElementById("giftRain");
    const giftsTitle = document.getElementById("giftsTitle");

    // Memories + sheet
    const memoriesList = document.getElementById("memoriesList");
    const addMemoryBtn = document.getElementById("addMemoryBtn");
    const memorySheet = document.getElementById("memorySheet");
    const closeSheetBtn = document.getElementById("closeSheetBtn");
    const saveMemoryBtn = document.getElementById("saveMemoryBtn");
    const clearMemoryBtn = document.getElementById("clearMemoryBtn");
    const memTitle = document.getElementById("memTitle");
    const memLabel = document.getElementById("memLabel");
    const memText = document.getElementById("memText");

    // ===== Helpers
    function showToast(message){
      toastEl.textContent = message;
      toastEl.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toastEl.classList.remove("show"), 2200);
    }

    function showModal(el){ el.classList.add("show"); }
    function hideModal(el){ el.classList.remove("show"); }

    function getCurrentName(){
      return (friendName.value || "").trim().slice(0,28) || "Bestie";
    }

    function applyName(name){
      const n = (name || "").trim().slice(0,28) || "My Favorite Human";
      friendName.value = n;
      headline.textContent = `Happy Valentineâ€™s Day, ${n}! ğŸ’—`;
      letterName.textContent = n;
      letterInlineName.textContent = n;
      giftsTitle.textContent = `ğŸ Gifts Rain for ${n}!`;
    }

    function buildShareLink(name){
      const url = new URL(window.location.href);
      url.searchParams.set("to", name);
      return url.toString();
    }
    function getToParam(){
      const p = new URLSearchParams(window.location.search);
      return (p.get("to") || "").trim().slice(0,28);
    }

    // Confetti burst
    const burstLayer = document.getElementById("burst");
    function burstConfetti(x,y){
      for(let i=0;i<28;i++){
        const c=document.createElement("div");
        c.className="confetti";
        c.style.left=x+"px"; c.style.top=y+"px";
        c.style.background=`hsl(${Math.random()*360} 90% 65%)`;
        const a=Math.random()*Math.PI*2, d=60+Math.random()*160;
        c.style.setProperty("--x", Math.cos(a)*d+"px");
        c.style.setProperty("--y", Math.sin(a)*d-(40+Math.random()*60)+"px");
        c.style.setProperty("--r", (Math.random()*360)+"deg");
        burstLayer.appendChild(c);
        setTimeout(()=>c.remove(),900);
      }
    }

    // Floating hearts
    const hearts = document.getElementById("hearts");
    const heartChars = ["ğŸ’—","ğŸ’–","ğŸ’","ğŸ’•","âœ¨","ğŸŒ¸"];
    setInterval(()=>{
      const h=document.createElement("div");
      h.className="heart";
      h.textContent=heartChars[Math.floor(Math.random()*heartChars.length)];
      h.style.left=(Math.random()*100)+"vw";
      h.style.fontSize=(14+Math.random()*16)+"px";
      h.style.animationDuration=(5+Math.random()*6)+"s";
      hearts.appendChild(h);
      setTimeout(()=>h.remove(),12000);
    }, 550);

    // Fade-in on scroll
    let revealObserver=null;
    function initRevealObserver(){
      revealObserver=new IntersectionObserver(entries=>{
        entries.forEach(e=>{
          if(e.isIntersecting){ e.target.classList.add("show"); revealObserver.unobserve(e.target); }
        });
      },{threshold:.12});
      document.querySelectorAll(".reveal").forEach(el=>revealObserver.observe(el));
    }

    // ===== Name + Link Modal actions
    createLinkBtn.onclick = async () => {
      const name = modalFriendName.value.trim();
      if(!name){
        modalFriendName.focus();
        showToast("Type a friend name ğŸ˜Š");
        return;
      }
      applyName(name);

      const link = buildShareLink(name.slice(0,28));
      shareLinkText.textContent = link;
      openLink.href = link;
      shareBox.style.display = "grid";
      burstConfetti(window.innerWidth/2, 160);

      try{ await navigator.clipboard.writeText(link); showToast("Link copied ğŸ’Œ"); }catch(e){}
    };

    copyBtn.onclick = async () => {
      try{
        await navigator.clipboard.writeText(shareLinkText.textContent);
        showToast("Link copied! ğŸ’—");
      }catch(e){
        showToast("Copy failed â€” copy manually ğŸ™‚");
      }
    };

    skipBtn.onclick = () => hideModal(startModal);

    // ===== Open Letter (main button)
    openLetterMainBtn.onclick = () => {
      applyName(getCurrentName());
      letterBox.scrollTop = 0;
      showModal(letterModal);
      burstConfetti(window.innerWidth/2, 140);
      showToast("Opening your letter ğŸ’Œ");
    };

    closeLetterBtn.onclick = () => hideModal(letterModal);

    // ===== Friendship Burst (toast)
    burstBtn.onclick = () => {
      const name = getCurrentName();
      burstConfetti(window.innerWidth/2, 180);
      const lines = [
        `ğŸ‰ Friendship Burst! Youâ€™re amazing, ${name}! ğŸ’–`,
        `ğŸŒˆ Bestie vibes only â€” ${name}, you rock! ğŸ«¶`,
        `ğŸ’— Sending good vibes your way, ${name}! âœ¨`,
        `ğŸ¥³ Too much awesomeness detected: ${name} ğŸ˜„`,
        `ğŸ«ğŸ‚ğŸ§¸ğŸ for ${name}! Friendship power ğŸ’`
      ];
      showToast(lines[Math.floor(Math.random()*lines.length)]);
    };

    // ===== Gifts rain
    let giftsTimer = null;
    const giftEmojis = ["ğŸ«","ğŸ‚","ğŸ§¸","ğŸ’—","ğŸ","ğŸ¬","ğŸª","ğŸ’","âœ¨"];
    function startGiftsRain(){
      giftRain.innerHTML = "";
      if(giftsTimer) clearInterval(giftsTimer);
      giftsTimer = setInterval(spawnGift, 120);
      burstConfetti(window.innerWidth/2, 160);
    }
    function stopGiftsRain(){
      if(giftsTimer) clearInterval(giftsTimer);
      giftsTimer = null;
      setTimeout(()=>{ giftRain.innerHTML=""; }, 500);
    }
    function spawnGift(){
      const el = document.createElement("div");
      el.className = "giftItem";
      el.textContent = giftEmojis[Math.floor(Math.random()*giftEmojis.length)];

      const size = 18 + Math.random()*26;
      const left = Math.random()*100;
      const dur = 3.5 + Math.random()*3.5;
      const drift = (Math.random()*80 - 40);

      el.style.left = left + "vw";
      el.style.fontSize = size + "px";
      el.style.animationDuration = dur + "s";
      el.style.transform = `translateX(${drift}px)`;
      el.style.opacity = 0.95;

      giftRain.appendChild(el);
      setTimeout(()=> el.remove(), (dur*1000) + 200);
    }

    openGiftsBtn.onclick = () => {
      const name = getCurrentName();
      giftsTitle.textContent = `ğŸ Gifts Rain for ${name}!`;
      showModal(giftsOverlay);
      startGiftsRain();
      showToast("Gifts are raining! ğŸğŸ’—");
    };

    closeGiftsBtn.onclick = () => {
      hideModal(giftsOverlay);
      stopGiftsRain();
    };

    // ===== Add memory (localStorage)
    const STORAGE_KEY="valentine_friend_memories_v1";
    function showSheet(){ memorySheet.classList.add("show"); setTimeout(()=>memTitle.focus(), 60); }
    function hideSheet(){ memorySheet.classList.remove("show"); }
    function loadSavedMemories(){
      try{ const d=JSON.parse(localStorage.getItem(STORAGE_KEY)||"[]"); return Array.isArray(d)?d:[]; }catch(e){return[];}
    }
    function saveMemories(list){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }catch(e){} }
    function createMemoryElement({title,label,text}){
      const item=document.createElement("div");
      item.className="memory-item reveal";
      item.innerHTML=`<div class="memory-title"><span></span><span class="memory-label"></span></div><p class="memory-text"></p>`;
      item.querySelector(".memory-title span").textContent=title;
      item.querySelector(".memory-label").textContent=label;
      item.querySelector(".memory-text").textContent=text;
      return item;
    }
    function renderSavedMemories(){
      loadSavedMemories().forEach(m=>{
        const el=createMemoryElement(m);
        memoriesList.appendChild(el);
        if(revealObserver) revealObserver.observe(el);
      });
    }
    addMemoryBtn.onclick=()=>showSheet();
    closeSheetBtn.onclick=()=>hideSheet();
    clearMemoryBtn.onclick=()=>{ memTitle.value=""; memLabel.value=""; memText.value=""; memTitle.focus(); };
    saveMemoryBtn.onclick=()=>{
      const title=memTitle.value.trim().slice(0,60);
      const label=memLabel.value.trim().slice(0,24)||"Memory";
      const text=memText.value.trim().slice(0,220);
      if(!title||!text){ showToast("Add a title and memory ğŸ˜Š"); return; }
      const list=loadSavedMemories();
      list.unshift({title,label,text});
      saveMemories(list);
      const el=createMemoryElement({title,label,text});
      memoriesList.insertBefore(el, memoriesList.firstChild);
      if(revealObserver) revealObserver.observe(el);
      hideSheet();
      clearMemoryBtn.onclick();
      burstConfetti(window.innerWidth/2,200);
      showToast("Memory saved ğŸ’—");
    };

    // ===== INTRO (FIXED: no loop after opening shared link)
    const introText = "Welcome! To Valentine Card Gift ğŸ’ Create Your Valentine Card For Your Fav Person & Share It ...";
    let ti = 0;

    function typeIntro(){
      if(ti < introText.length){
        typedEl.textContent += introText.charAt(ti);
        ti++;
        setTimeout(typeIntro, 40);
      } else {
        setTimeout(finishIntro, 700);
      }
    }

    function finishIntro(){
      loader.classList.add("hide");
      setTimeout(() => loader.remove(), 650);

      // âœ… If shared link has ?to=NAME â†’ apply and SKIP asking name again
      const toName = getToParam();
      if(toName){
        applyName(toName);
        // Don't show startModal again
      } else {
        // Normal flow
        showModal(startModal);
      }
    }

    // ===== INIT
    initRevealObserver();
    renderSavedMemories();
    window.addEventListener("load", typeIntro);
  </script>
</body>
</html>

